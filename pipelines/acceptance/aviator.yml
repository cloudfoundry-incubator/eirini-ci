# Acceptance
spruce:
- base: $PROJECT_ROOT/pipelines/modules/deploy-eirini.yml
  merge:
  - with:
      files:
      - $PROJECT_ROOT/pipelines/acceptance/environment.yml
      - $PROJECT_ROOT/pipelines/modules/smoke-tests-with-eirini-release-trigger.yml
      - $PROJECT_ROOT/notifications/slack/hook.yml
      - $PROJECT_ROOT/notifications/slack/deploy-eirini.yml
  to: {{eirini-environment}}

- base: $PROJECT_ROOT/pipelines/acceptance/publish-release.yml
  merge:
  - with:
      files:
      - $PROJECT_ROOT/pipelines/acceptance/environment.yml
  to: {{publish-release}}

- base: $PROJECT_ROOT/pipelines/acceptance/weekly-blobstore-cleanup.yml
  merge:
  - with:
      files:
      - $PROJECT_ROOT/pipelines/acceptance/environment.yml
  to: {{weekly-blobstore-cleanup}}

- base: $PROJECT_ROOT/pipelines/modules/empty.yml
  prune:
  - meta
  merge:
  - with:
      files:
      - {{eirini-environment}}
      - {{publish-release}}
      - {{weekly-blobstore-cleanup}}
  modify:
    delete:
      - "resources.name:cluster-acceptance-staging-event-ready"
      - "jobs.name:deploy-scf-uaa-acceptance.plan.get:cluster-acceptance-staging-event-ready"
  to: $PIPELINE_YML
