spruce:
- base: $PROJECT_ROOT/pipelines/modules/kube-cluster.yml
  prune:
  - meta
  merge:
  - with:
      files:
      - $PROJECT_ROOT/pipelines/acceptance/meta.yml
  to: {{cluster}}

- base: $PROJECT_ROOT/pipelines/modules/deploy-eirini.yml
  merge:
  - with:
      files:
      - $PROJECT_ROOT/pipelines/acceptance/meta.yml
  to: {{eirini}}

- base: $PROJECT_ROOT/pipelines/modules/run-core-cats.yml
  prune:
  - cats_conf
  merge:
  - with:
      files:
      - $PROJECT_ROOT/pipelines/acceptance/cats-conf.yml
      - $PROJECT_ROOT/pipelines/acceptance/meta.yml
  to: {{cats}}

- base: $PROJECT_ROOT/pipelines/modules/test-and-build-docker-images.yml
  merge:
  - with:
      files:
      - $PROJECT_ROOT/pipelines/acceptance/meta.yml
  to: {{test-and-build-docker}}

- base: $PROJECT_ROOT/pipelines/acceptance/publish-release.yml
  merge:
  - with:
      files:
      - $PROJECT_ROOT/pipelines/acceptance/meta.yml
  to: {{publish-release}}

- base: $PROJECT_ROOT/pipelines/modules/empty.yml
  prune:
  - meta
  merge:
  - with:
      files:
      - {{cluster}}
      - {{test-and-build-docker}}
      - {{eirini}}
      - {{cats}}
      - {{publish-release}}
  to: $PIPELINE_YML
