spruce:
- base: $PROJECT_ROOT/pipelines/modules/kube-cluster.yml
  prune:
  - meta
  merge:
  - with:
      files:
      - $PROJECT_ROOT/pipelines/ci-new/with-diego.yml
  to: {{cluster-with-diego}}

- base: $PROJECT_ROOT/pipelines/modules/deploy-eirini.yml
  prune:
  - meta
  merge:
  - with:
      files:
      - $PROJECT_ROOT/pipelines/ci-new/with-diego.yml
  to: {{eirini-with-diego}}

- base: $PROJECT_ROOT/pipelines/modules/kube-cluster.yml
  prune:
  - meta
  merge:
  - with:
      files:
      - $PROJECT_ROOT/pipelines/ci-new/with-opi.yml
  to: {{cluster-with-opi}}

- base: $PROJECT_ROOT/pipelines/modules/deploy-eirini.yml
  prune:
  - meta
  merge:
  - with:
      files:
      - $PROJECT_ROOT/pipelines/ci-new/with-opi.yml
  to: {{eirini-with-opi}}

- base: $PROJECT_ROOT/pipelines/ci-new/empty.yml
  prune:
  - cats_conf
  merge:
  - with:
      files:
        - {{cluster-with-diego}}
        - {{cluster-with-opi}}
        - {{eirini-with-diego}}
        - {{eirini-with-opi}}
        - $PROJECT_ROOT/pipelines/modules/test-and-build-docker-images.yml
        - $PROJECT_ROOT/pipelines/ci-new/cats-conf.yml
        - $PROJECT_ROOT/pipelines/modules/run-core-cats.yml
  to: $PIPELINE_YML

