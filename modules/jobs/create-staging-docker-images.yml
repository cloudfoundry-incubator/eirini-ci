jobs:
- name: create-staging-docker-images
  plan:
  - in_parallel:
      steps:
      - get: eirini-staging
        passed:
        - staging-test
        trigger: true
  - task: make-docker-build-args
    input_mapping:
        repository: eirini-staging
    config:
       platform: linux
       image_resource:
         type: docker-image
         source:
           repository: eirini/ci
       inputs:
       - name: repository
       outputs:
       - name:  docker-build-args
       run:
         path: /usr/bin/env
         args:
         - bash
         - -c
         - (( file "../../inline-tasks/make-docker-build-args.sh" ))
  - in_parallel:
      steps:
      - put: docker-staging-downloader
        params:
          build: eirini-staging
          build_args_file: docker-build-args/args.json
          dockerfile: eirini-staging/image/downloader/Dockerfile
      - put: docker-staging-executor
        params:
          build: eirini-staging
          build_args_file: docker-build-args/args.json
          dockerfile: eirini-staging/image/executor/Dockerfile
      - put: docker-staging-uploader
        params:
          build: eirini-staging
          build_args_file: docker-build-args/args.json
          dockerfile: eirini-staging/image/uploader/Dockerfile
  on_failure: (( grab slack-notification.on_failure ))
